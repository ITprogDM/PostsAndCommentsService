# Posts And Comments Service

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —á—Ç–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GraphQL

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- üìù **–ü–æ—Å—Ç—ã**
    - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤
    - –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
    - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–µ—Ç–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –ø–æ—Å—Ç—É

- üí¨ **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**
    - –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é
    - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞ (2000 —Å–∏–º–≤–æ–ª–æ–≤)
    - –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
    - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ GraphQL Subscriptions (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

**PostgreSQL** (–≤ –∫–∞—á–µ—Å—Ç–≤–µ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö)

**Docker**

**golang-migrate/migrate** (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –ë–î)

**Sqlx** (–¥—Ä–∞–π–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL)

**golang/mock, testify** (–¥–ª—è unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

**GraphQL**: gqlgen

**–•—Ä–∞–Ω–∏–ª–∏—â–∞** 2 –≤–∏–¥–∞:
- Inmemory 
- PostgreSQL

## üîß –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ c –ø–æ–º–æ—â—å—é Docker –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

–ó–∞–ø–æ–ª–Ω–∏—Ç—å .env —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example. (–£–∫–∞–∂–∏—Ç–µ –≤ .env POSTGRES_HOST=database); –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Inmemory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
(–£–∫–∞–∑–∞—Ç—å IN_MEMORY=true)

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å:
```
make start-docker
```
–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î:
```
make migrate
```

## üîß –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

–ó–∞–ø–æ–ª–Ω–∏—Ç—å .env —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example. (–£–∫–∞–∂–∏—Ç–µ –≤ .env POSTGRES_HOST=localhost); –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Inmemory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ 
(–£–∫–∞–∑–∞—Ç—å IN_MEMORY=true) 

–ó–∞–ø—É—Å—Ç–∏—Ç—å –ë–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
```
make start-db
```
–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î:
```
make migrate
```
–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:
```
make start-local
```
## –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ –≤ Docker –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:
–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```
make stop-docker
```

## üê≥ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```
make test
```
## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞

```
mutation CreatePost {
    CreatePost(
        post: {
            name: "–¢–µ—Å—Ç"
            content: "–¢–µ—Å—Ç–¢–µ—Å—Ç"
            author: "–¢–µ—Å—Ç1"
            commentsAllowed: true
        }
    ) {
        id
        createdAt
        name
        author
        content
    }
}
```


### –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ—Å—Ç–æ–≤

```
query GetAllPosts {
    GetAllPosts(page: 1, pageSize: 3) {
        id
        createdAt
        name
        author
        content
    }
}
```


### –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –ø–æ—Å—Ç–µ
```
query GetPostById {
    GetPostById(id: 1) {
        id
        createdAt
        name
        author
        content
        commentsAllowed
        comments(page: 1, pageSize: 2) {
            id
            createdAt
            author
            content
            post
            replies {
                id
                createdAt
                author
                content
                post
                replyTo
            }
        }
    }
}
```

### –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

```
mutation CreateComment {
    CreateComment(input: { author: "–¢–µ—Å—Ç1", content: "–¢–µ—Å—Ç–¢–µ—Å—Ç–æ–≤", post: "1" }) {
        id
        createdAt
        author
        content
        post
        replyTo
    }
}
```


### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

```
subscription CommentsSubscription {
    CommentsSubscription(postId: "1") {
        id
        createdAt
        author
        content
        post
        replyTo
    }
}
```

